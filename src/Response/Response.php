<?php
/**
 * Created by PhpStorm.
 * User: lixingbo
 * Date: 2018/9/25
 * Time: 下午5:39
 */

namespace Ddup\Part\Response;


use Illuminate\Contracts\Support\Arrayable;

class Response extends \Illuminate\Http\Response
{

    private $_code = 'success';
    private $_msg;
    private $_data;

    private $code_success = 'success';
    private $code_fail    = 'fail';

    function data($data)
    {
        if ($data instanceof Arrayable) {
            $data = $data->toArray();
        }

        $this->_data = $data;

        return self::updateContent();
    }

    function code($code)
    {
        $this->_code = $code;

        return self::updateContent();
    }

    function success()
    {
        $this->_code = $this->code_success;

        return self::updateContent();
    }

    function isSuccess()
    {
        return $this->_code == $this->code_success;
    }

    function fail()
    {
        $this->_code = $this->code_fail;

        return self::updateContent();
    }

    function message($msg)
    {
        $this->_msg = $msg;

        return self::updateContent();
    }

    function msg($msg)
    {
        return self::message($msg);
    }

    private function updateContent()
    {
        parent::setContent($this->completeContent());

        return $this;
    }

    public function setContent($content)
    {
        if ($this->shouldBeJson($content)) {
            $this->_data = $content;
        }

        return parent::setContent($this->completeContent()); // TODO: Change the autogenerated stub
    }

    private function completeContent()
    {
        return [
            'retcode' => $this->_code,
            'msg'     => $this->_msg,
            'data'    => $this->_data
        ];
    }
}